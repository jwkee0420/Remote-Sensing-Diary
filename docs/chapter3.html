<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Week 3: All about Remote Sensing Data – Quartobook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./chapter2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3: All about Remote Sensing Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Quartobook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CASA0023 Jin’s Learning Diary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week 1: Getting started with Remote Sensing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The essential tools: Xaringan &amp; Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3: All about Remote Sensing Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pre-processing" id="toc-pre-processing" class="nav-link active" data-scroll-target="#pre-processing"><span class="header-section-number">4</span> Pre-processing</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">5</span> Applications</a>
  <ul class="collapse">
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation"><span class="header-section-number">5.1</span> Motivation?</a></li>
  <li><a href="#reflections" id="toc-reflections" class="nav-link" data-scroll-target="#reflections"><span class="header-section-number">5.2</span> Reflections</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3: All about Remote Sensing Data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="pre-processing" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Pre-processing</h1>
<p>This week’s content is slightly more technical, covering the different flaws in remote-sensing data and the different ways we can account and correct for them. The flaws and artifacts in the data can come from the technical properties of the sensor, to atmospheric conditions while capturing data across earth. Each flaw is a huge can of worms, with extensive research and modelling happening in the background to ensure that the data that we download publicly is fit to use without distortions or influences from weather, sensor flaws or orthographic projection errors.</p>
<p>In simple terms, the pre-processing types can be arranged into four seperate categories:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type of Correction</th>
<th>Image Flaw and Causes</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Geometric Correction</td>
<td>Image distortion introduced from view angle, topography, wind conditions and rotation of the earth. Using data collected from the sensor such as exact orbit, altitude, imaging parameters, and ground control points, images are resampled so that locations and accurate pixel values can be calculated.</td>
<td><p><img src="images/resampling.png" class="img-fluid"></p>
<p>Image credits: <a href="http://tlclab.unipv.it/downloads/STLR_Radar/20120402/05_Geometric_correction.pdf">Università di Pavia</a></p>
<p>Resampling methods llike nearest neighbour, bilinear and bicubic (illustrated) are a key geometric correction step when reprojecting different geographic referencing systems which are found in many GIS softwares today.</p></td>
</tr>
<tr class="even">
<td>Atmospheric Correction (subset of radiometric correction)</td>
<td><p>Caused by atmospheric scattering of light which can create ‘adjacency effect’. Atmospheric correction is also divided into two methods: absolute and relative.</p>
<p><img src="images/hazing.png" class="img-fluid"></p>
<p>Image Credits: <a href="https://www.mdpi.com/2072-4292/9/10/972#">Sun et. al (2017)</a></p></td>
<td><p>Absolute atmospheric correction examples:</p>
<ol type="1">
<li>Using <strong>atmospheric radiative transfer models</strong> which converts digital numbers (DN) into scaled surface reflectance. This requires either private tools (which costs money) or open-source tools</li>
<li><strong>Empirical Line Correction</strong> using in-situ reflectance measurements of a known material and establishing a linear model</li>
</ol>
<p>Relative atmospheric corrections examples:</p>
<ol type="1">
<li><strong>Dark Object Subtraction (DOS)</strong> correct images relative to a single image or other images, using a dark object feature (like water) as a reference point, assuming near zero reflectance.</li>
</ol></td>
</tr>
<tr class="odd">
<td>Orthorectification Correction (subset of geometric correction)</td>
<td>Distortions caused by sensor tilt and topographical relief. Orthorectification ensures that each point appear as if each pixel is captured directly below the sensor.</td>
<td>An example orthorectification correction is cosine correction which accounts for the angle at which sunlight hits the earth, causing variability in brightness.</td>
</tr>
<tr class="even">
<td>Radiometric Correction</td>
<td>Spectral information captured by satellites are affected by atmospheric scattering, absorption which require correction, turning DNs to spectral radiance values.</td>
<td>The <a href="https://d9-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/atoms/files/LSDS-1574_L8_Data_Users_Handbook-v5.0.pdf">data handbook for Landsat-8</a> outlines several radiometric corrections based on the sensor property in order to correct for inconsistency for specific spectral bands. These include the OLI solar diffuser, lunar irradiance and underfly acquisitions among many others.</td>
</tr>
</tbody>
</table>
<p>I also created a small dictionary for key terms learnt this week for quick referencing and look up of definitions.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Terminology</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Digital Number (DN)</td>
<td><ul>
<li><p>Numerical values that represent the intensity of electromagnetic radiation and usually converted to radiance/reflectance</p></li>
<li><p>Raw data collected by satellites and range from 0-65535 (Landsat-8)</p></li>
<li><p>Unitless - do not represent a physical measurement</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Radiance</td>
<td><ul>
<li><p>Also called Top-of-Atmosphere (TOA) radiance</p></li>
<li><p>Includes radiation from sun, neighbouring pixels, from clouds etc</p></li>
<li><p>Depends on orientation, path of light, position of target</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>Reflectance</td>
<td><ul>
<li><p>Property of the material (which is what we want) extracted from radiant corrected data</p></li>
<li><p>Either TOA reflectance or surface reflectance</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Analysis Ready Data (ARD)</td>
<td><ul>
<li>Data which has been pre-processed according to the content above; also include cloud masking</li>
</ul></td>
</tr>
<tr class="odd">
<td>Band Ratioing</td>
<td><ul>
<li>Technique used to display spectral variations, enhancing contrast by dividing reflectance of one image band by another image band</li>
</ul></td>
</tr>
<tr class="even">
<td>Spectral Indices</td>
<td><ul>
<li><p>Are essentially band ratios or a combination of band ratios</p></li>
<li><p>Reduce impact of atmospheric conditions or illumination differences</p></li>
<li><p>A library of indices can be found <a href="https://www.indexdatabase.de/db/i.php">here</a></p></li>
</ul></td>
</tr>
<tr class="odd">
<td>High/Low Pass Filter</td>
<td><ul>
<li><p>Image processing techniques</p></li>
<li><p>Low pass = smoothing, reduce edges/noise</p></li>
<li><p>High pass = sharpen, enhance edge and fine details</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Texture</td>
<td><ul>
<li><p>Spatial arrangement of pixels in an image; provides information on surface roughness, patterns which helps determine land use types</p></li>
<li><p>Consider an example like grasslands vs forests: similar spectral properties but different textures</p></li>
<li><p>First-order - based on individual pixel values; Second-order - based on spatial arrangement of pixels pairs as seen in GLCM</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>Pan-sharpen</td>
<td><ul>
<li>Using a higher resolution spectral band to enhance resolution of a lower resolution spectral band</li>
</ul></td>
</tr>
<tr class="even">
<td>Principle Component Analysis</td>
<td><ul>
<li><p>A process that turns original pixel values into uncorrelated values called Principle Components</p></li>
<li><p>Pixel values are standardised before eigenvector/values is computed from a covariance matrix; each pixel is then mapped onto a new PCA axes</p></li>
<li><p>Removes redundancy, and correlation between bands</p></li>
</ul></td>
</tr>
</tbody>
</table>
</section>
<section id="applications" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Applications</h1>
<section id="motivation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">5.1</span> Motivation?</h2>
<p>This week I challenged myself to reading a few more technical papers discussing more about Land Cover and Land-Use (LCLU) applications of remote sensing, with the focus on methodologies used to classify them from Grey-Level Co-occurrence Matrix (GLCM) to machine learning methods such as Random Forest (RF), Support Vector Machine (SVM) in Object Based Image Analysis (OBIA). While it took a long time to understand what the papers were discussing or proposing, I felt that with the help of this week’s content and some googling, I could make sense of what the authors are investigating.</p>
<p>The first paper by Mryka Hall-Beyer (2017) is a particular introductory paper on GLCM - she first gives an overview of what GLCM is, its background on textures and the problems with using GLCM. One key issue with Principle Component Analysis used in GLCM is how it is dependent on the researcher choosing which measures and window size to use; and interpret PCA to decide which component to use for land-use classification. Hall-Beyer wishes to address this issue by developing a guideline for choosing relevant GLCM texture measures across different neighbourhood sizes and land covers. She produces different combinations of textures and window sizes on different land covers, and extract similar patterns seen in these combinations. The author found that even across very different land covers, GLCM Mean texture measure should be used as a first choice for classification, with GLCM Cor being used as an addition if necessary. GLCM Con should be used to characterise edge-like features and GLCM Ent can be added for more detailed studies. However, the author cautioned that these are just general guidelines for choosing GLCM textures and every image is different based on features that one might want to characterize. For example, <a href="https://www.sciencedirect.com/science/article/pii/S0303243410000097?casa_token=TEblmSg5LcoAAAAA:lqzDWClzFvFlrJ4qyhbvhkLU4xiNp3eA9y8JxUk_XfDFm0v0ABR1SuikW2rppD10yJ12OjUohSc">Murray et al.&nbsp;(2010)</a> found that the use of Mean, Con and Ent generated the most accurate land-use maps specifically for tundra vegetation. The author also raised an important point to always report textures and combination used along with its accuracies rather than just reporting the most successful model. This can help identify evidence-drive patterns and build a library of ‘textures combinations’ which is helpful for all researchers.</p>
<p>The second paper explores the use of GLCM textures in vegetation identification. <a href="https://www.mdpi.com/2072-4292/14/18/4585">Mohammadpour et al.&nbsp;(2022)</a> developed a methodology integrating 4 vegetation indices and 12 texture variables into Sentinel 2A spectral bands to classify various vegetation species in complex land classification, with applications in wildfire risk management and biomass monitoring.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/process1.png" class="img-fluid figure-img"></p>
<figcaption><em>Process of vegetation mapping with Sentinel 2. Image taken from Mohammadpour et al.&nbsp;(2022)</em></figcaption>
</figure>
</div>
<p>I think this process really aptly summarises the content I learnt this week - first we have reprojection/resampling, which is part of geometric corrections and image enhancement. Clipping region of interest is the same process of this week’s practical, for example using terra::crop and terra::mask. The authors used 4 vegetation indices: Normalized Difference Vegetation Index (NDVI), Green Normalized Difference Vegetation Index (GNDVI), Enhanced Vegetation Index (EVI), and Soil Adjusted Vegetation Index (SAVI), which are various band ratios covered in this week’s lectures as well. Texture extraction using GLCM was seen in the practical, although the paper covered the process in more details; including explaining the choice of texture metrics to bring forward to the Random Forest (RF). The model achieved a high Overall Accuracy of 90.9% and texture metrics seem to have increased the classification accuracy.</p>
</section>
<section id="reflections" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="reflections"><span class="header-section-number">5.2</span> Reflections</h2>
<p>This week’s content is pretty daunting at first glance, as we covered a lot of technical content behind how pre-processing works (and the math involved!), even though we probably do not need to handle much of the pre-processing ourselves. However, I do agree with Andy that it is still important for us to understand the calibrations and corrections that are occurring behind the scenes so that we understand <em>where</em> our data came from.</p>
<p>The second part of the lecture is very very interesting as image enhancement is a constantly evolving field, with different researchers developing new techniques or combining old ones to map out features that they would like to investigate. While reading the papers that utilises image enhancement and correction techniques, I learnt a lot more on the intricacies and problems behind mapping each feature, for example issues with mapping vegetation and their individual species. I realised that there is no one size fit all solution to image classification/enhancement; it depends on our own study area, climate and subject that we want to capture/map. All these tools and techniques are available to us but choosing the most appropriate ones and justifying these choices are the most important and crucial part of the research.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter2.html" class="pagination-link" aria-label="The essential tools: Xaringan &amp; Quarto">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The essential tools: Xaringan &amp; Quarto</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link" aria-label="Summary">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>